# **Introdução: De Scripts a Programas**

Até este momento, a maior parte do nosso código foi escrita em *scripts*. Um script é um arquivo `.m` contendo uma sequência de comandos que são executados de cima para baixo, como se tivessem sido digitados diretamente na *Command Window*. Eles operam no espaço de trabalho base (*base workspace*), compartilhando variáveis entre si.

Embora úteis, os scripts têm limitações para projetos maiores:

- **Repetição de Código:** Se você precisa realizar a mesma tarefa complexa em vários lugares, acaba copiando e colando o mesmo bloco de código.
- **Manutenção Difícil:** Se precisar corrigir um erro ou alterar a lógica nesse bloco copiado, terá que alterá-lo em todos os lugares.
- **Falta de Clareza:** Scripts longos podem se tornar um emaranhado de variáveis e operações, dificultando o entendimento e a depuração.

A solução para esses problemas é a **função**. Uma função é um bloco de código autocontido e reutilizável que executa uma tarefa específica. Ela recebe dados de entrada (argumentos), processa-os em seu próprio espaço de trabalho isolado e retorna um resultado (saída). Este encapsulamento é um dos princípios fundamentais da boa engenharia de software.

# **A Anatomia de uma Função no MATLAB**

Toda função no MATLAB é definida em um arquivo `.m` e segue uma estrutura sintática rigorosa.

**Estrutura Fundamental:**

```matlab
function [saida1, saida2, ...] = nomeDaFuncao(entrada1, entrada2, ...)
%
% AJUDA/DOCUMENTAÇÃO DA FUNÇÃO
% Esta é a primeira linha do help. Descreve a função em uma frase.
% Em seguida, vêm explicações mais detalhadas sobre o que a função faz,
% quais são seus parâmetros de entrada e o que ela retorna.
% Exemplo de uso:
%   [media, dp] = nomeDaFuncao(meusDados);
%

% Corpo da função: código que realiza a tarefa
% ...
% Atribuição dos valores às variáveis de saída
saida1 = ...;
saida2 = ...;
% ...

end % O 'end' no final de um arquivo de função é opcional, mas é boa prática
```

**Componentes Essenciais:**

1. **Palavra-chave `function`**: Toda definição de função deve começar com esta palavra.
2. **Argumentos de Saída `[saida1, saida2, ...]`**: Variáveis que a função retornará. Se houver apenas uma saída, os colchetes são opcionais. Se não houver nenhuma, esta parte e o `=` são omitidos.
3. **Nome da Função `nomeDaFuncao`**: Este é o nome que você usará para chamar a função. **Regra de Ouro:** O arquivo `.m` **deve** ser salvo com o mesmo nome da função (neste caso, `nomeDaFuncao.m`).
4. **Argumentos de Entrada `(entrada1, entrada2, ...)`**: Variáveis que a função recebe para trabalhar.
5. **Documentação (Help Text)**: Os comentários que vêm logo após a linha de definição da função servem como sua documentação. Ao digitar `help nomeDaFuncao` na *Command Window*, o MATLAB exibirá exatamente este texto. Documentar seu código é uma prática profissional indispensável.
6. **Corpo da Função**: Onde a lógica da função reside. É aqui que os cálculos são feitos.

**Exemplo Prático: Função para Calcular Média e Desvio Padrão**

Vamos criar uma função que recebe um vetor de dados e retorna a média e o desvio padrão.

**1. Crie um novo arquivo e salve-o como `calcularEstatisticas.m`**

**2. Digite o seguinte código no arquivo:**

```matlab
function [media, desvio_padrao] = calcularEstatisticas(dados)
%CALCULARESTATISTICAS Calcula a média e o desvio padrão de um vetor de dados.
%   [media, dp] = CALCULARAESTATISTICAS(dados) retorna a média (media) e
%   o desvio padrão (dp) dos elementos do vetor 'dados'.

    n = length(dados);
    media = sum(dados) / n;
    variancia = sum((dados - media).^2) / (n-1);
    desvio_padrao = sqrt(variancia);

end
```

**3. Use a função a partir da *Command Window* ou de outro script:**

```matlab
% Certifique-se de que o arquivo 'calcularEstatisticas.m' está na pasta atual do MATLAB

meus_valores = [12, 15, 11, 13, 14, 10];

% Chamando a função para obter ambos os resultados
[med, dp] = calcularEstatisticas(meus_valores);
fprintf('A média é %.2f e o desvio padrão é %.2f.\n', med, dp);

% Chamando a função para obter apenas o primeiro resultado (a média)
media_apenas = calcularEstatisticas(meus_valores);
fprintf('A média é %.2f.\n', media_apenas);
```

# **Escopo de Variáveis e Argumentos Opcionais**

**Espaço de Trabalho (Workspace) da Função**
Uma característica fundamental das funções é que elas possuem seu próprio **espaço de trabalho isolado**. Variáveis criadas dentro de uma função (como `n` e `variancia` no nosso exemplo) são **locais**: elas só existem enquanto a função está sendo executada e são destruídas quando a função termina. Elas não interferem com nenhuma variável do *workspace* base, mesmo que tenham o mesmo nome. Os dados só entram em uma função através dos argumentos de entrada e só saem através dos argumentos de saída.

**Argumentos Opcionais com `nargin`**
Às vezes, é útil ter argumentos de entrada que são opcionais. O MATLAB fornece uma variável especial, `nargin` (*number of input arguments*), que informa quantas entradas foram de fato fornecidas na chamada da função. Podemos usar isso com uma estrutura `if` para definir valores padrão.

**Exemplo: Uma função de plotagem com estilo de linha opcional**

```matlab
% Salve este código como 'plotarSimples.m'
function plotarSimples(x, y, estilo)
%PLOTARSIMPLES Plota y vs. x com um estilo de linha opcional.
%   Se o estilo não for fornecido, usa uma linha azul sólida ('b-').

    if nargin < 3
        % O terceiro argumento ('estilo') não foi fornecido
        estilo = 'b-'; % Define um valor padrão
    end

    figure;
    plot(x, y, estilo);
    title('Gráfico Gerado pela Função');
    grid on;

end

% Como usar:
% x_dados = 1:10;
% y_dados = x_dados.^2;
% plotarSimples(x_dados, y_dados); % Chama com 2 argumentos, usa o padrão
% plotarSimples(x_dados, y_dados, 'r--o'); % Chama com 3 argumentos, usa o fornecido
```

# **Tópicos Avançados de Funções**

A ementa menciona alguns conceitos mais avançados, que são importantes para a organização de projetos maiores.

**Compartilhamento de Dados com Variáveis `global`**
É possível criar variáveis que são compartilhadas entre múltiplos workspaces (funções e base) usando a palavra-chave `global`.

**AVISO:** O uso de variáveis globais é **fortemente desaconselhado** na programação moderna. Elas quebram o encapsulamento das funções, tornando o código extremamente difícil de depurar e manter, pois qualquer função pode modificar a variável a qualquer momento. Use-as apenas se for absolutamente inevitável. É mencionado aqui por ser parte da ementa, não como uma recomendação.

**Subfunções**

Você pode definir múltiplas funções dentro de um único arquivo `.m`. A primeira função no arquivo é a **função principal** (a que pode ser chamada de fora do arquivo), e quaisquer outras funções abaixo dela são chamadas de **subfunções**. As subfunções são visíveis apenas para a função principal e para as outras subfunções no mesmo arquivo. Elas são úteis como "funções auxiliares" para quebrar a lógica da função principal em partes menores.

**Funções Privadas**

Se você criar uma subpasta chamada `private` dentro da pasta do seu projeto, quaisquer funções `.m` que você colocar dentro dela só poderão ser chamadas por funções e scripts localizados na pasta pai (a pasta imediatamente acima). Isso é útil para criar funções de "uso interno" de um toolbox, que não devem ser expostas ao usuário final.

**"Funções de Funções" (*Function Handles*)**

Este é um conceito extremamente poderoso. Assim como você pode ter uma variável que armazena um número ou um vetor, você pode ter uma variável que "aponta" para uma função. Isso é chamado de **function handle**, e é criado com o símbolo `@`.

```matlab
% Criando um handle para a função 'sin'
meu_calculo = @sin;

% Agora podemos usar a variável 'meu_calculo' como se fosse a própria função
resultado = meu_calculo(pi/2); % resultado será 1

% O principal uso é passar uma função como argumento para outra função.
% Por exemplo, muitas funções de otimização ou integração do MATLAB
% pedem que você passe a função matemática que você quer otimizar/integrar.

% Exemplo de uma função que recebe outra função como entrada:
% function plotarFuncao(funcao_handle, x_min, x_max)
%    x = linspace(x_min, x_max, 200);
%    y = funcao_handle(x);
%    plot(x, y);
% end
%
% Chamada: plotarFuncao(@cos, -pi, pi);
```